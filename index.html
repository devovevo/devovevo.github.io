<!DOCTYPE html>
<html>
<head>
<style>
* {
  margin: 0 auto;
}
body, html {
   height: 1500px;
}
#metronomeDraw {
   position: absolute;
   left: 0;
   top: 0;
   height:300px; 
   width:100%;
}
#grad1 {
  height: 100%;
  background-color: red; /* For browsers that do not support gradients */
  background-image: linear-gradient(rgb(212, 0, 255), rgb(89, 0, 255));
}
#metronomeButton {
  position: absolute;
  padding: 10px;
  left: 45%;
  width: 200px;
  height: 80px;
  top: 300px;
  background-color: green;
  font-size: large;
}
#audioButton {
  position: absolute;
  padding: 10px;
  left: 44.4%;
  width: 230px;
  height: 40px;
  top: 410px;
  background-color: red;
  font-size: large;
}
#bpm {
  position: absolute;
  text-align: center;
  top: 470px;
  left: 48%;
  font-size: large;
  color: whitesmoke;
}
#bpmInput {
  position: absolute;
  top: 500px;
  left: 47%;
  width: 70px;
  border: 3px solid #73AD21;
  padding: 10px;
  background-color: whitesmoke;
}
#recognizerButton {
  position: absolute;
  padding: 10px;
  left: 44.4%;
  width: 230px;
  height: 60px;
  top: 650px;
  background-color: cyan;
  font-size: large;
}
#recognizerDraw {
   position: absolute;
   left: 0;
   top: 710px;
   height: 790px; 
   width: 100%;
}
</style>
</head>
<body>

<div id="grad1"></div>
<canvas id="metronomeDraw" inp></canvas>

<button id="metronomeButton" type="button" >Click here for metronome.</button>
<button id="audioButton" type="button" >Click here to toggle beep.</button>
<label id="bpm" >BPM:</label>
<input id="bpmInput" type="text" value="120" >
<button id="recognizerButton" type="button" >Click here to toggle note recognition.</button>
<canvas id="recognizerDraw"></canvas>

<script src="src/NoteRecognizer.js" ></script>
<script src="src/Metronome.js"></script>
<script>
  const metronomeCanvas = document.getElementById("metronomeDraw");
  const ticker = new Metronome(metronomeCanvas, 0, 0);

  const recognizerCanvas = document.getElementById("recognizerDraw");
  const recognizer = new NoteRecognizer(recognizerCanvas);

  var metronomeButton = document.getElementById("metronomeButton");
  metronomeButton.addEventListener("click", toggleMetronome);

  var audioButton = document.getElementById("audioButton");
  audioButton.addEventListener("click", toggleAudio);

  var recognitionButton = document.getElementById("recognizerButton");
  recognitionButton.addEventListener("click", toggleRecognition);

  var input = document.getElementById("bpmInput");

  function toggleAudio(click)
  {
    if (ticker.noise == true)
    {
      ticker.noise = false;
    }
    else
    {
      ticker.noise = true;
    }
  }

  function toggleMetronome(click)
  {
    if (ticker.ticking == true)
    {
      ticker.stopTicking();
    }
    else
    {
      try
      {
        ticker.setBPM(parseInt(input.value));
        recognizer.setDelay(parseInt(input.value));
      }
      catch (err)
      {
      }

      ticker.startTicking();
    }
  }

  async function toggleRecognition(click)
  {
    if (recognizer.recognizing)
    {
      recognizer.stopRecognizingNotes();
    }
    else
    {
      if (recognizer.audioAnalyzer == null)
      {
        await recognizer.getAudioStream();
      }

      recognizer.startRecognizingNotes();
    }
  }
</script>

</body>
</html>